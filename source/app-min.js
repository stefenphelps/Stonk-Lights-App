const{Control:Control,Discovery:Discovery}=require("magic-home"),cryptocoins=require("./functions/cryptocoins.js"),stock=require("./functions/stock.js"),stockMarket=require("./functions/stockMarket.js"),stonkLight=require("./functions/stonkLight.js");var loadingIndicator=document.querySelector(".scanning"),lightTemplate=document.querySelector("#lights-item"),lightsContainer=document.querySelector(".lights"),lightSettingsTemplate=document.querySelector("#light-settings");function sleep(t){return new Promise((e=>setTimeout(e,t)))}var discovery=new Discovery;async function theLoop(t,e,o){var r=0,i=0;if(e)for(;e;)0==r||(await sleep(31e3),i=await cryptocoins.getPrice(o),await stonkLight.colorChange(t,i,r)),r=await cryptocoins.getPrice(o);else for(;stockMarket.isOpen();)0==r||(i=await stock.getPrice(o),await stonkLight.colorChange(t,i,r)),r=await stock.getPrice(o)}discovery.scan(500).then((t=>{loadingIndicator.classList.add("hidden"),t.forEach((function(t,e){var o=new Control(t.address);o.setPower(!0).then((t=>{var r=lightTemplate.content.cloneNode(!0);r.querySelector(".lights-item").id="light-button-"+e,lightsContainer.appendChild(r);var i=document.importNode(lightSettingsTemplate.content,!0);i.querySelector(".dialog").id="dialog-"+e,document.body.appendChild(i);var c=document.querySelector("#dialog-"+e+" input#stock"),n=document.querySelector("#dialog-"+e+' label[for="stock"]'),l=document.querySelector("#dialog-"+e+" input#crypto"),s=document.querySelector("#dialog-"+e+' label[for="crypto"]'),u=document.querySelector("#dialog-"+e+" input#symbol"),a=document.querySelector("#dialog-"+e+' label[for="symbol"]');c.setAttribute("id","stock-"+e),n.setAttribute("for","stock-"+e),l.setAttribute("id","crypto-"+e),s.setAttribute("for","crypto-"+e),u.setAttribute("id","symbol-"+e),a.setAttribute("for","symbol-"+e),document.querySelectorAll(".lights-item")[e].addEventListener("click",(function(){document.querySelector("#dialog-"+e).showModal();var t=document.querySelectorAll(".category-fieldset-items input"),o=document.querySelector(".symbol-fieldset"),r=document.querySelector(".symbol-fieldset input"),i=document.querySelector(".start-button");t.forEach((function(t){t.addEventListener("click",(function(){o.style="display: block";var t=this.value;document.querySelector(".symbol-text").textContent=t}))})),r.addEventListener("keyup",(function(){i.style="display: block;"})),document.querySelector("#dialog-"+e+" .start-button").addEventListener("click",(function(){document.querySelector("#light-button-"+e+" span").textContent=r.value,document.querySelector("#dialog-"+e).close()}))}));theLoop(o,!1,"TSLA")}))}))}));
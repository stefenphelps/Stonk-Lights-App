const{Control:Control,Discovery:Discovery}=require("magic-home"),cryptocoins=require("./functions/cryptocoins.js"),stock=require("./functions/stock.js"),stockMarket=require("./functions/stockMarket.js"),stonkLight=require("./functions/stonkLight.js");var loadingIndicator=document.querySelector(".scanning"),lightTemplate=document.querySelector("#lights-item"),lightsContainer=document.querySelector(".lights"),lightSettingsTemplate=document.querySelector("#light-settings");function sleep(e){return new Promise((t=>setTimeout(t,e)))}var discovery=new Discovery;async function theLoop(e,t,o){var i=0,r=0;if(t)for(;t;)0==i?i=await cryptocoins.getPrice(o):(await sleep(31e3),r=await cryptocoins.getPrice(o),console.log({newPrice:r}),await stonkLight.colorChange(e,r,i),await sleep(31e3),i=await cryptocoins.getPrice(o),console.log({oldPrice:i}));else for(;stockMarket.isOpen();)0==i||(await sleep(2e3),r=await stock.getPrice(o),await stonkLight.colorChange(e,r,i),await sleep(2e3)),i=await stock.getPrice(o)}discovery.scan(500).then((e=>{loadingIndicator.classList.add("hidden"),e.forEach((function(e,t){var o=new Control(e.address);o.setPower(!0).then((e=>{var i=lightTemplate.content.cloneNode(!0);i.querySelector(".lights-item").id="light-button-"+t,lightsContainer.appendChild(i);var r=document.importNode(lightSettingsTemplate.content,!0);r.querySelector(".dialog").id="dialog-"+t,document.body.appendChild(r);var c=document.querySelector("#dialog-"+t+" input#stock"),n=document.querySelector("#dialog-"+t+' label[for="stock"]'),l=document.querySelector("#dialog-"+t+" input#crypto"),s=document.querySelector("#dialog-"+t+' label[for="crypto"]'),a=document.querySelector("#dialog-"+t+" input#symbol"),u=document.querySelector("#dialog-"+t+' label[for="symbol"]');c.setAttribute("id","stock-"+t),n.setAttribute("for","stock-"+t),l.setAttribute("id","crypto-"+t),s.setAttribute("for","crypto-"+t),a.setAttribute("id","symbol-"+t),u.setAttribute("for","symbol-"+t),document.querySelectorAll(".lights-item")[t].addEventListener("click",(function(){document.querySelector("#dialog-"+t).showModal();var e=document.querySelectorAll(".category-fieldset-items input"),i=document.querySelector(".symbol-fieldset"),r=document.querySelector(".symbol-fieldset input"),c=document.querySelector(".start-button");e.forEach((function(e){e.addEventListener("click",(function(){i.style="display: block";var e=this.value;document.querySelector(".symbol-text").textContent=e}))})),r.addEventListener("keyup",(function(){c.style="display: block;"})),document.querySelector("#dialog-"+t+" .start-button").addEventListener("click",(function(){document.querySelector("#light-button-"+t+" span").textContent=r.value,document.querySelector("#dialog-"+t).close();theLoop(o,!1,"TSLA")}))}))}))}))}));